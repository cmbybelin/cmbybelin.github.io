---
id: portfolio
---

{% include head.html portfolio_section=page.title %}

 <article class="portfolio">
  <h2>{{ page.excerpt }}</h2>
  <div class="photo">
  {% for photo in page.portfolio %}
   <div id="img{{ forloop.index }}" class="caroussel{% if forloop.first %} selected{% endif %}" style="background-image: url('/portfolio/{{ page.portfolio_folder }}/{{ photo.photo | replace:' ','%20' }}')"/>
    {% if photo.caption %}<p class="caption"><span>{{ photo.caption | newline_to_br }}</span></p>{% endif %}
   </div>
  {% endfor %}
  </div>
   <div class="navigate previous"><span>&lt;</span></div>
   <div class="navigate next"><span>&gt;</span></div>
  <div class="thumbnails">
  {% for photo in page.portfolio %}
   <img rel="img{{ forloop.index }}" src="/thumbs/{{ page.portfolio_folder }}/{{ photo.photo | replace:' ','%20' }}" alt="{{ photo.caption }}" draggable="false"/>
  {% endfor %}
  </div>
 </article>

 <script>
    (function (document) {
       var $caroussel = document.querySelectorAll('.caroussel');
       var $thumbnails = document.querySelectorAll('.thumbnails img');

       for (var i = 0; i < $thumbnails.length; i++) {
         $thumbnails[i].addEventListener('click', function() {
           var selectedImg = document.querySelector('.caroussel.selected');
           var id = this.getAttribute('rel');
           if (selectedImg) {
             selectedImg.classList.remove('selected');
           }
           document.getElementById(id).classList.add('selected');
         });
       }

       var $next = document.querySelector('.navigate.next');
       var $previous = document.querySelector('.navigate.previous');

       $next.addEventListener('click', selectNext);
       $next.addEventListener('touchstart', handleTouchStart);
       $next.addEventListener('touchmove', handleTouchMove);
       $next.addEventListener('touchend', handleTouchEnd);
       $previous.addEventListener('click', selectPrevious);
       $previous.addEventListener('touchstart', handleTouchStart);
       $previous.addEventListener('touchmove', handleTouchMove);
       $previous.addEventListener('touchend', handleTouchEnd);

       var startX, startY;

       for (var i = 0; i < $caroussel.length; i++) {
         $caroussel[i].addEventListener('touchstart', handleTouchStart);
         $caroussel[i].addEventListener('touchmove', handleTouchMove);
         $caroussel[i].addEventListener('touchend', handleTouchEnd);
       }

       function handleTouchStart(e) {
         // fade:
         var selectedImg = document.querySelector('.caroussel.selected');
         selectedImg.style.transition = 'none';
         // next/prev:
         startX = e.changedTouches[0].screenX;
         startY = e.changedTouches[0].screenY;
       }

       function handleTouchMove(e) {
	 // fade:
	 var selectedImg = document.querySelector('.caroussel.selected');
	 var width = document.width * 1.2;
	 var height = document.height * 1.2;
	 var endX = e.changedTouches[0].screenX;
	 var endY = e.changedTouches[0].screenY;
	 selectedImg.style.opacity = Math.max(1.0 - Math.max((Math.abs(endX - startX) / width), (Math.abs(endY - startY) / height)), 0.3);
	 e.preventDefault();
       }

       function handleTouchEnd(e) {
	 var dWidth = document.width / 6;
	 var dHeight = document.height / 6;
	 var endX = e.changedTouches[0].screenX;
	 var endY = e.changedTouches[0].screenY;
	 if ((startX - endX > dWidth) || (startY - endY > dHeight)) {
	   selectNext();
	 } else if ((endX - startX > dWidth) || (endY - startY > dHeight)) {
	   selectPrevious();
	 }
       }

       function unselect() {
	 var selectedImg = document.querySelector('.caroussel.selected');
	 selectedImg.style.opacity = '';
	 selectedImg.style.transition = '';
	 selectedImg.classList.remove('selected');
	 return selectedImg;
       }

       function selectNext() {
	 var selectedImg = unselect();
	 if (selectedImg.nextElementSibling) {
	   selectedImg.nextElementSibling.classList.add('selected');
	 } else {
	   selectedImg.parentElement.firstElementChild.classList.add('selected');
	 }
       }

       function selectPrevious() {
	 var selectedImg = unselect();
	 if (selectedImg.previousElementSibling) {
	   selectedImg.previousElementSibling.classList.add('selected');
	 } else {
	   selectedImg.parentElement.lastElementChild.classList.add('selected');
	 }
       }
     })(document);
 </script>

{% include tail.html %}

